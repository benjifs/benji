---
permalink: feed.json
eleventyExcludeFromCollections: true
---
{%- set jsonfeed %}
{%- for feed in metadata.feeds -%}
{%- if feed.type == "application/json" %}{{ feed.href }}{% endif -%}
{%- endfor -%}
{% endset -%}
{
	"version": "https://jsonfeed.org/version/1",
	"title": "{{ metadata.title }}",
	"home_page_url": "{{ metadata.url }}",
	"feed_url": "{{ jsonfeed }}",
	"description": "{{ metadata.description }}",
	"favicon": "{{ metadata.favicon }}",
	"icon": "{{ metadata.icon }}",
	"author": {
		"name": "{{ metadata.author.name }}",
		"url": "{{ metadata.author.url }}",
		"avatar": "{{ metadata.author.image }}"
	},
	"items": [
		{%- for item in collections.feed | reverse | limit(20) %}
		{
			"id": "{{ metadata.url }}{{ item.url }}",
			"url": "{{ metadata.url }}{{ item.url }}",
			{%- if item.data.title %}
			"title": "{{ item.data.title }}",
			{%- elif item.data['in-reply-to'] %}
			"title": "Reply to {{ item.data['in-reply-to'] }}",
			{%- endif %}
			{%- set textContent -%}
				{%- if item.data.summary -%}
					{%- if item.data['watch-of'] -%}
					{{ "Rewatched " if item.data['watch-of'].properties and item.data['watch-of'].properties.rewatch else "Watched " }}
					{%- endif -%}
					{{ item.data.summary }}
				{%- endif -%}
			{% endset %}
			{% if textContent -%}
			"content_text": "{{ textContent | safe }}",
			{% else -%}
			"content_text": "{{ item.templateContent | striptags | truncate(80) | trim }}",
			"content_html": {{ item.templateContent | dump | safe }},
			{% endif -%}
			"date_published": "{{ item.date | dateISO }}"
			{%- if item.data.tags -%}
			,
			"tags": [
				"{{ item.data.tags | join('", "') | safe }}"
			]
			{%- endif %}
		}
		{%- if not loop.last -%}
		,
		{%- endif -%}
		{%- endfor %}
	]
}
